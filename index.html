<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HSG Canvas - Synthwave Edition</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Rajdhani:wght@300;400;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/static/styles.css">
</head>
<body>
    <div class="container">
        <!-- Synthwave Header -->
        <div class="header">
            <h1>HSG CANVAS</h1>
            <p><span class="status-indicator"></span>SYNTHWAVE EDITION | <span id="resolution-display">DETECTING RESOLUTION...</span></p>
        </div>

        <!-- Hero Section: YouTube & Audio (Primary Focus) -->
        <div class="hero">
            <!-- Unified Video Playback -->
            <div class="card">
                <h2>üì∫ VIDEO PLAYBACK</h2>
                <p>Stream YouTube videos with or without audio</p>

                <!-- Output Target Selection -->
                <div style="margin-bottom: 15px; padding: 12px; background: rgba(114, 9, 183, 0.1); border-radius: 8px; border: 1px solid var(--neon-purple);">
                    <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 8px;">
                        <label style="font-weight: bold; margin: 0; flex-shrink: 0;">Output Target:</label>
                        <select id="videoTargetSelect" style="flex: 1; max-width: 300px; margin: 0;">
                            <option value="">Loading targets...</option>
                        </select>
                        <button class="small-btn refresh-targets-btn" title="Refresh Chromecasts">üîÑ</button>
                    </div>
                    <div id="videoTargetStatus" style="font-size: 12px; color: var(--neon-cyan); margin-top: 5px;"></div>
                </div>

                <!-- Preset Selection -->
                <div style="margin-bottom: 10px;">
                    <label style="display: block; margin-bottom: 5px; font-weight: bold;">Quick select (auto-starts):</label>
                    <select id="videoPresets" style="width: 100%; max-width: 400px;">
                        <option value="">Choose preset...</option>
                        <optgroup label="24/7 Live Streams">
                            <option value="https://www.youtube.com/watch?v=jfKfPfyJRdk">Lofi Hip Hop Radio</option>
                            <option value="https://www.youtube.com/watch?v=36YnV9STBqc">The Good Life Radio</option>
                            <option value="https://www.youtube.com/watch?v=5yx6BWlEVcY">Chillhop Radio</option>
                        </optgroup>
                        <optgroup label="Nature & Relaxation">
                            <option value="https://www.youtube.com/watch?v=UgHKb_7884o">Relaxing Fireplace (12h)</option>
                            <option value="https://www.youtube.com/watch?v=UVfex2bCJCQ">8K Yule Log (8h)</option>
                        </optgroup>
                    </select>
                </div>

                <!-- URL Input (Always Visible) -->
                <div style="margin-bottom: 15px;">
                    <label style="display: block; margin-bottom: 5px; font-weight: bold;">Or enter any URL:</label>
                    <input type="url" id="customVideoUrl" placeholder="https://www.youtube.com/watch?v=..." style="width: 100%; max-width: 400px;">
                </div>

                <!-- Audio Toggle and Duration (Same Line) -->
                <div style="margin: 20px 0; padding: 15px; background: rgba(114, 9, 183, 0.1); border-radius: 8px;">
                    <div style="display: flex; align-items: center; justify-content: space-between; flex-wrap: wrap; gap: 20px;">
                        <!-- Audio Toggle -->
                        <div style="display: flex; align-items: center; gap: 15px;">
                            <span style="font-weight: bold; font-size: 1rem; color: #888;">MUTED</span>
                            <label class="audio-toggle-switch">
                                <input type="checkbox" id="videoAudioEnabled">
                                <span class="toggle-slider"></span>
                            </label>
                            <span style="font-weight: bold; font-size: 1rem;">AUDIO</span>
                        </div>

                        <!-- Duration Input -->
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <label style="font-weight: bold; white-space: nowrap;">Duration (s):</label>
                            <input type="number" id="videoDuration" placeholder="blank = continuous" min="1" max="7200" style="width: 150px;">
                        </div>
                    </div>
                </div>

                <!-- Controls -->
                <div style="margin-top: 15px; display: flex; justify-content: space-between; align-items: center;">
                    <button id="playVideoBtn" style="font-size: 1.1rem; padding: 12px 24px;">‚ñ∂ PLAY VIDEO</button>
                    <button id="stopVideoBtn" class="danger" style="font-size: 1.1rem; padding: 12px 24px;">‚èπ STOP</button>
                </div>
                <div id="videoStatus" style="margin-top: 15px; font-size: 14px; color: var(--neon-cyan);"></div>
            </div>

            <!-- Audio Streaming -->
            <div class="card">
                <h2>üéµ AUDIO STREAMING</h2>
                <p>Stream from Soma.FM, web radio, or any audio URL</p>

                <!-- Output Target Selection -->
                <div style="margin-bottom: 15px; padding: 12px; background: rgba(114, 9, 183, 0.1); border-radius: 8px; border: 1px solid var(--neon-purple);">
                    <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 8px;">
                        <label style="font-weight: bold; margin: 0; flex-shrink: 0;">Output Target:</label>
                        <select id="audioTargetSelect" style="flex: 1; max-width: 300px; margin: 0;">
                            <option value="">Loading targets...</option>
                        </select>
                        <button class="small-btn refresh-targets-btn" title="Refresh Chromecasts">üîÑ</button>
                    </div>
                    <div id="audioTargetStatus" style="font-size: 12px; color: var(--neon-cyan); margin-top: 5px;"></div>
                </div>

                <!-- Quick Stream Selection -->
                <div style="margin-bottom: 15px;">
                    <select id="quickStreamSelect" style="width: 100%; max-width: 400px;" >
                        <option value="">Select a stream...</option>
                        <optgroup label="soma.fm Stations">
                            <option value="https://somafm.com/groovesalad.pls">Groove Salad</option>
                            <option value="https://somafm.com/dronezone.pls">Drone Zone</option>
                            <option value="https://somafm.com/lush.pls">Lush</option>
                            <option value="https://somafm.com/digitalis.pls">Digitalis</option>
                            <option value="https://somafm.com/defcon.pls">DEF CON Radio</option>
                        </optgroup>
                    </select>
                </div>

                <input type="url" id="audioStreamUrl" placeholder="Or enter custom URL..." style="width: 100%; max-width: 400px;">
                <br>
                <div style="display: flex; align-items: center; gap: 10px; margin: 10px 0;">
                    <input type="range" id="audioVolume" min="0" max="100" value="80" style="width: 200px;">
                    <label style="margin: 0;">Volume: <span id="volumeDisplay">80</span>%</label>
                </div>
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <button id="startAudioBtn">‚ñ∂ START AUDIO</button>
                    <button id="stopAudioBtn" class="danger">‚èπ STOP</button>
                </div>
                <div id="audioStatus" style="margin-top: 15px; font-size: 14px; color: var(--neon-cyan);"></div>
            </div>

            <!-- Chromecast -->
            <div class="card">
                <h2>üì∫ CHROMECAST</h2>
                <p>Cast media to Chromecast devices on your network</p>

                <!-- Device Discovery -->
                <div style="margin-bottom: 15px;">
                    <button id="discoverChromecastBtn">DISCOVER</button>
                    <select id="chromecastDevice" style="width: 100%; max-width: 400px; margin-top: 10px; display: none;">
                        <option value="">Select a device...</option>
                    </select>
                </div>

                <input type="url" id="chromecastUrl" placeholder="Enter media URL to cast..." style="width: 100%; max-width: 400px;">
                <br>
                <div style="display: flex; align-items: center; gap: 10px; margin: 10px 0;">
                    <input type="range" id="chromecastVolume" min="0" max="100" value="50" style="width: 200px;">
                    <label style="margin: 0;">Volume: <span id="chromecastVolumeDisplay">50</span>%</label>
                </div>
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <div>
                        <button id="startChromecastBtn">‚ñ∂ START CAST</button>
                        <button id="pauseChromecastBtn">‚è∏ PAUSE</button>
                    </div>
                    <button id="stopChromecastBtn" class="danger">‚èπ STOP</button>
                </div>
                <div id="chromecastStatus" style="margin-top: 15px; font-size: 14px; color: var(--neon-cyan);"></div>
            </div>

            <!-- Cast Receiver -->
            <div class="card">
                <h2>üì± RECEIVE CASTS</h2>
                <p>Cast FROM your phone/tablet TO this Canvas</p>

                <div id="castReceiverStatus" style="margin: 15px 0; padding: 15px; background: rgba(0, 245, 255, 0.1); border-radius: 8px;">
                    <span style="text-shadow: 0 0 10px var(--neon-cyan);">‚è≥ Checking receiver status...</span>
                </div>

                <p style="font-size: 0.9rem; color: rgba(255,255,255,0.7); margin-top: 10px;">
                    üìå To cast to this Canvas:<br>
                    1. Open a cast-enabled app on your phone<br>
                    2. Look for "HSG Canvas" in the cast menu<br>
                    3. Select it to start casting<br>
                    <br>
                    Supported: YouTube, audio streams, video URLs
                </p>
            </div>
        </div>

        <!-- Toggle Button for Advanced Features -->
        <div class="toggle-advanced">
            <button class="toggle-btn" id="toggleAdvancedBtn">
                <span id="toggleText">‚öôÔ∏è SHOW ADVANCED FEATURES</span>
            </button>
        </div>

        <!-- Advanced Features Section (Hidden by Default) -->
        <div id="advancedFeatures" class="advanced-features">

            <!-- Tabs for Advanced Features -->
            <div class="tabs">
                <button class="tab-btn active" id="tab-btn-streams">üåä STREAMS</button>
                <button class="tab-btn" id="tab-btn-display">üñºÔ∏è DISPLAY</button>
                <button class="tab-btn" id="tab-btn-system">üìä SYSTEM</button>
                <button class="tab-btn" id="tab-btn-advanced">‚öôÔ∏è ADVANCED</button>
            </div>

            <!-- Tab Content: Streams -->
        <div id="tab-streams" class="tab-content active">
            <div class="grid">
                <!-- Playback Control -->
                <div class="card">
                    <h2>‚ñ∂Ô∏è PLAY STREAM</h2>
                    <p>Watch RTMP/HTTP-FLV/HLS streams</p>
                    <input type="text" id="playbackKey" placeholder="Stream Key" value="oke">
                    <select id="player">
                        <option value="mpv">MPV (Recommended)</option>
                        <option value="ffplay">FFplay</option>
                        <option value="omxplayer">OMXPlayer</option>
                        <option value="vlc">VLC</option>
                    </select>
                    <select id="playMode">
                        <option value="optimized">Optimized</option>
                        <option value="fullscreen">Fullscreen</option>
                        <option value="basic">Basic</option>
                    </select>
                    <select id="playProtocol">
                        <option value="rtmp">RTMP</option>
                        <option value="http_flv">HTTP-FLV (Lower latency)</option>
                        <option value="hls">HLS</option>
                    </select>
                    <br>
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <button id="startPlaybackBtn">START PLAYBACK</button>
                        <button id="stopPlaybackBtn" class="danger">STOP</button>
                    </div>
                </div>

                <!-- Start Stream -->
                <div class="card">
                    <h2>üì° START STREAM</h2>
                    <p>Republish files or cameras to SRS</p>
                    <input type="text" id="streamKey" placeholder="Stream Key" value="mystream">
                    <input type="text" id="sourceUrl" placeholder="Source URL or file path" style="width: 100%; max-width: 300px;">
                    <select id="streamProtocol">
                        <option value="rtmp">RTMP</option>
                    </select>
                    <br>
                    <button id="startStreamBtn">START STREAM</button>
                </div>

                <!-- Screen Streaming -->
                <div class="card">
                    <h2>üì° SCREEN STREAM</h2>
                    <p>Stream display output (META)</p>
                    <input type="text" id="screenStreamKey" placeholder="Stream key" value="desktop">
                    <select id="screenStreamProtocol">
                        <option value="rtmp">RTMP</option>
                        <option value="http_flv">HTTP-FLV</option>
                        <option value="hls">HLS</option>
                    </select>
                    <br>
                    <button id="screenStreamButton">START SCREEN STREAM</button>
                    <div id="screenStreamStatus" style="margin-top: 10px;"></div>
                </div>

                <!-- Active Streams -->
                <div class="card">
                    <h2>üî¥ ACTIVE STREAMS</h2>
                    <div id="activeStreams" class="streams-list">No active streams</div>
                </div>
            </div>
        </div>

        <!-- Tab Content: Display -->
        <div id="tab-display" class="tab-content">
            <div class="grid">
                <!-- Image Display -->
                <div class="card">
                    <h2>üñºÔ∏è DISPLAY IMAGE</h2>
                    <p>Show fullscreen images</p>
                    <input type="file" id="imageFile" accept="image/*" style="width: 100%;">
                    <input type="number" id="imageDuration" placeholder="Duration (seconds)" value="10" min="1" max="300">
                    <br>
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <button id="displayImageBtn">DISPLAY IMAGE</button>
                        <button id="stopDisplayImageBtn" class="danger">STOP</button>
                    </div>
                </div>

                <!-- QR Code -->
                <div class="card">
                    <h2>üì± QR CODE</h2>
                    <p>Generate and display QR codes</p>
                    <input type="text" id="qrContent" placeholder="URL or text..." style="width: 100%; max-width: 300px;">
                    <input type="number" id="qrDuration" placeholder="Duration (seconds)" min="1" max="300">
                    <br>
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <button id="displayQRCodeBtn">GENERATE QR CODE</button>
                        <button id="stopQRCodeBtn" class="danger">STOP</button>
                    </div>
                </div>

                <!-- Background Control -->
                <div class="card">
                    <h2>üñºÔ∏è BACKGROUND</h2>
                    <p>Manage background display</p>
                    <div style="margin-bottom: 15px;">
                        <button id="staticModeBtn" class="mode-button active">
                            STATIC BACKGROUND
                        </button>
                    </div>
                    <div id="staticControls">
                        <input type="file" id="backgroundFile" accept="image/*" style="width: 100%;">
                        <br>
                        <button id="setBackgroundBtn">SET BACKGROUND</button>
                    </div>
                    <button id="refreshBackgroundBtn">üîÑ REFRESH</button>
                    <button id="showBackgroundBtn">SHOW NOW</button>
                    <div id="backgroundStatus" style="margin-top: 10px; color: var(--neon-cyan);"></div>
                </div>
            </div>
        </div>

        <!-- Tab Content: System -->
        <div id="tab-system" class="tab-content">
            <div class="grid">
                <!-- System Status -->
                <div class="card">
                    <h2>üìä SYSTEM STATUS</h2>
                    <div id="status" class="status">Click refresh to load...</div>
                    <div id="systemStats" class="stats"></div>
                    <button id="refreshStatusBtn">üîÑ REFRESH STATUS</button>
                </div>

                <!-- Current Playback -->
                <div class="card">
                    <h2>üé¨ CURRENT PLAYBACK</h2>
                    <div id="currentPlayback" style="color: rgba(255,255,255,0.8);">No active playback</div>
                </div>

                <!-- Quick Actions -->
                <div class="card">
                    <h2>‚ö° QUICK ACTIONS</h2>
                    <input type="text" id="switchKey" placeholder="New stream key">
                    <br>
                    <button id="switchStreamBtn">SWITCH STREAM</button>
                    <button id="switchPlayerMpvBtn" class="small-btn">MPV</button>
                    <button id="switchPlayerFfplayBtn" class="small-btn">FFPLAY</button>
                </div>

                <!-- Navigation Links -->
                <div class="card">
                    <h2>üìö DOCUMENTATION</h2>
                    <a href="/docs" style="color: var(--neon-cyan); text-decoration: none; display: block; margin: 10px 0;">‚Üí API Documentation</a>
                    <a href="/docs/quick-start" style="color: var(--neon-cyan); text-decoration: none; display: block; margin: 10px 0;">‚Üí Quick Start Guide</a>
                    <a href="/diagnostics" style="color: var(--neon-pink); text-decoration: none; display: block; margin: 10px 0;">‚Üí System Diagnostics</a>
                    <a href="/status" style="color: var(--neon-cyan); text-decoration: none; display: block; margin: 10px 0;">‚Üí Server Status JSON</a>
                    <a href="/health" style="color: var(--neon-cyan); text-decoration: none; display: block; margin: 10px 0;">‚Üí Health Check</a>
                </div>
            </div>
        </div>

        <!-- Tab Content: Advanced -->
        <div id="tab-advanced" class="tab-content">
            <div class="grid">
                <!-- Spotify Connect -->
                <div class="card">
                    <h2>üéß SPOTIFY CONNECT</h2>
                    <p>Cast Spotify Premium from your phone</p>
                    <div id="spotifyStatus" style="margin-bottom: 15px; padding: 15px; background: rgba(0,245,255,0.1); border-radius: 10px; border: 1px solid var(--neon-cyan);">
                        <div><strong>Device:</strong> <span id="spotifyDeviceName">HSG Canvas</span></div>
                        <div><strong>Status:</strong> <span id="spotifyServiceStatus">Checking...</span></div>
                    </div>

                    <!-- Now Playing Info -->
                    <div id="spotifyPlaybackInfo" style="display: none; margin-bottom: 15px; padding: 15px; background: rgba(29,185,84,0.1); border-radius: 10px; border: 1px solid #1DB954;">
                        <div style="font-size: 1.1em; margin-bottom: 10px;"><strong>üéµ Now Playing</strong></div>
                        <div style="margin-bottom: 5px;"><strong>Track:</strong> <span id="spotifyTrackId">-</span></div>
                        <div style="margin-bottom: 5px;"><strong>Duration:</strong> <span id="spotifyDuration">-</span></div>
                        <div style="font-size: 0.85em; opacity: 0.7;"><span id="spotifyLastEvent">-</span></div>
                    </div>

                    <button id="refreshSpotifyBtn" style="background: #1DB954;">üîÑ REFRESH</button>
                    <div style="margin-top: 15px; padding: 15px; background: rgba(114,9,183,0.1); border-radius: 10px; font-size: 0.9em;">
                        <strong>HOW TO USE:</strong>
                        <ol style="margin: 10px 0 0 20px;">
                            <li>Open Spotify on your phone</li>
                            <li>Start playing music</li>
                            <li>Tap "Devices Available" icon</li>
                            <li>Select "HSG Canvas"</li>
                        </ol>
                    </div>
                </div>

                <!-- TV Control (HDMI-CEC) -->
                <div class="card">
                    <h2>üì∫ TV CONTROL</h2>
                    <p>HDMI-CEC power control</p>
                    <div style="margin-bottom: 15px;">
                        <button id="tvPowerOnBtn" style="background: #28a745;">‚ö° POWER ON</button>
                        <button id="tvPowerOffBtn" class="danger">üí§ POWER OFF</button>
                        <button id="refreshCECBtn">üîÑ REFRESH</button>
                    </div>
                    <div id="cecStatus">
                        <div><strong>CEC:</strong> <span id="cecAvailability">Checking...</span></div>
                        <div><strong>TV Power:</strong> <span id="tvPowerStatus">Unknown</span></div>
                        <div><strong>TV Address:</strong> <span id="tvAddress">-</span></div>
                    </div>
                </div>

                <!-- Website Casting -->
                <div class="card">
                    <h2>üåê WEBSITE CASTING</h2>
                    <p>Cast websites with auto-scroll</p>
                    <input type="url" id="webcastUrl" placeholder="https://example.com" style="width: 100%; max-width: 400px;">
                    <br>
                    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; margin: 15px 0;">
                        <div>
                            <label>Scroll Delay (s):</label>
                            <input type="number" id="scrollDelay" value="5" min="1" max="60" style="width: 100%;">
                        </div>
                        <div>
                            <label>Scroll %:</label>
                            <input type="number" id="scrollPercentage" value="30" min="10" max="90" style="width: 100%;">
                        </div>
                        <div>
                            <label>Overlap %:</label>
                            <input type="number" id="overlapPercentage" value="5" min="0" max="20" style="width: 100%;">
                        </div>
                        <div>
                            <label>Loops:</label>
                            <input type="number" id="loopCount" value="3" min="1" max="20" style="width: 100%;">
                        </div>
                    </div>
                    <select id="viewportSize" style="width: 100%; max-width: 400px;">
                        <option value="1920x1080">1920x1080 (Full HD)</option>
                        <option value="1280x720">1280x720 (HD)</option>
                        <option value="800x600">800x600 (4:3)</option>
                    </select>
                    <br>
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <button id="webcastStartBtn">‚ñ∂ START</button>
                        <button id="webcastStopBtn" class="danger">‚èπ STOP</button>
                    </div>
                    <div id="webcastStatus" style="margin-top: 10px;">
                        <div><strong>Status:</strong> <span id="webcastState">Stopped</span></div>
                    </div>
                </div>

            </div>
        </div>
    </div>

    <script src="/static/app.js"></script>
</body>
</html>
